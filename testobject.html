<!doctype html>
<html lang="en">
<head>
    <title>Pooltafel</title>
    <meta charset="utf-8">
</head>
<body>

    <style>html, body {margin: 0; height: 100%; overflow: hidden}</style>
    
    <script src="js/three.js"></script>
    <script src="js/OrbitControls.js"></script>
    <script src="js/loaders/OBJLoader.js"></script>
    <script src="js/Ball.js"></script>
</head>
<body>
<script>

    // Set up the scene, camera, and renderer as global variables.
    var scene, camera, renderer;

    init();
    animate();

    // Sets up the scene.
    function init() {

        // Create the scene and set the scene size.
        scene = new THREE.Scene();
        var WIDTH = window.innerWidth;
        var HEIGHT = window.innerHeight;

        // Create a renderer and add it to the DOM.
        renderer = new THREE.WebGLRenderer({antialias:true});
        renderer.setClearColor(0xCCCCFF, 1);
        renderer.setSize(WIDTH, HEIGHT);
        document.body.appendChild(renderer.domElement);

        // Create a camera, zoom it out from the model a bit, and add it to the scene.
        camera = new THREE.PerspectiveCamera(45, WIDTH / HEIGHT, 0.1, 20000);
        camera.position.set(0,6,0);
        scene.add(camera);

        // Create an event listener that resizes the renderer with the browser window.
        window.addEventListener('resize', function() {
            var WIDTH = window.innerWidth,
                HEIGHT = window.innerHeight;
            renderer.setSize(WIDTH, HEIGHT);
            camera.aspect = WIDTH / HEIGHT;
            camera.updateProjectionMatrix();
        });

        // Create a light, set its position, and add it to the scene.
        var pLight = new THREE.PointLight(0x909070);
        pLight.position.set(0,10,0);

        var aLight = new THREE.AmbientLight(0x404040);
        aLight.position.set(0,0,0);
        scene.add(pLight, aLight);

        // Load in the mesh and add it to the scene.
        var lakenTexture = new THREE.ImageUtils.loadTexture("textures/laken.png");
        var lakenMaterial = new THREE.MeshLambertMaterial( {map: lakenTexture} );

        var lakenGeometry = new THREE.BoxGeometry(3, 0.01, 6);

        var lakenMesh = new THREE.Mesh(lakenGeometry, lakenMaterial);

        scene.add(lakenMesh);

        // Add OrbitControls so that we can pan around with the mouse.
        controls = new THREE.OrbitControls(camera, renderer.domElement);

        //poolball
        var shinyWhiteMaterial = new THREE.MeshPhongMaterial({color: 0xFFFFFF});
        var sphereGeometry = new THREE.SphereGeometry(0.10, 32, 32);
        var sphereMeshW = new THREE.Mesh(sphereGeometry, shinyWhiteMaterial);
        sphereGeometry.translate(0, 0.0375, 0);


        scene.add(sphereMeshW);


        //keu
        var keuGeometry = new THREE.CylinderGeometry(0.1, 0.2, 8, 32, 32 );
        var keuMesh = new THREE.Mesh(keuGeometry, shinyWhiteMaterial);

        keuMesh.visible = false;

        scene.add(keuMesh);

        var loader = new THREE.OBJLoader();

        // load a resource
        loader.load(
            // resource URL
            'obj/pooltable.obj',
            // Function when resource is loaded
            function ( object ) {
                scene.add( object );
            }
        );

        this.balls = [
            new Ball(0, -13.5 / 2),

            new Ball(0, 4 + 2.75, 0.3075),

            new Ball(-0.32, 4.6 + 2.75, 0.3075),
            new Ball(0.32, 4.6 + 2.75, 0.3075),

            new Ball(0, 5.2 + 2.75, 0.3075),
            new Ball(0.64, 5.2 + 2.75, 0.3075),
            new Ball(-0.64, 5.2 + 2.75, 0.3075),

            new Ball(0.32, 5.8 + 2.75, 0.3075),
            new Ball(-0.32, 5.8 + 2.75, 0.3075),
            new Ball(0.96, 5.8 + 2.75, 0.3075),
            new Ball(-0.96, 5.8 + 2.75, 0.3075),

            new Ball(0, 6.4 + 2.75, 0.3075),
            new Ball(0.64, 6.4 + 2.75, 0.3075),
            new Ball(-0.64, 6.4 + 2.75, 0.3075),
            new Ball(1.28, 6.4 + 2.75, 0.3075),
            new Ball(-1.28, 6.4 + 2.75, 0.3075)
        ];
        scene.add(this);

        this.test = 1.0;
        this.test2 = 1.0;
    }



    // Renders the scene and updates the render as needed.
    function animate() {

        // Read more about requestAnimationFrame at http://www.paulirish.com/2011/requestanimationframe-for-smart-animating/
        requestAnimationFrame(animate);

        if (balls[0].position.z >= 2.8)
            test = -1.0;

        if (balls[0].position.z <= -2.8)
            test = 1.0;

        if (balls[0].position.x >= 1.4)
            test2 = -1.0;

        if (balls[0].position.x <= -1.4)
            test2 = 1.0;

        balls[0].position.z += 0.05 * test;
        balls[0].position.x += 0.04 * test2;

        // Render the scene.
        renderer.render(scene, camera);
        controls.update();

    }

</script>

</body>
</html>